/**
 * Advent of code 2020
 * @author : Nicolae Telechi
 */
#include <iostream>
#include <fstream>
#include <string>
#include <memory>
#include <algorithm>
#include <array>
#include <vector>
#include <sstream>
#include <fstream>
#include <set>
#include <map>
#include <unordered_set>
#include <unordered_map>
#include <optional>
#include <numeric>
#include <regex>

using namespace std;

#include "../../AOCLib/src/AOCLib.h"

struct Ship
{
  void SetPosition(AOC::Point position)
  {
    this->position = position;
  }

  AOC::Point GetPosition()
  {
    return position;
  }

  void TurnLeft()
  {
    switch (direction)
    {
    case '^':
      direction = '<';
      break;
    case '<':
      direction = 'v';
      break;
    case 'v':
      direction = '>';
      break;
    case '>':
      direction = '^';
      break;
    default:
      break;
    }
  }

  void TurnRight()
  {
    switch (direction)
    {
    case '^':
      direction = '>';
      break;
    case '>':
      direction = 'v';
      break;
    case 'v':
      direction = '<';
      break;
    case '<':
      direction = '^';
      break;
    default:
      break;
    }
  }

  void MoveForward(int step)
  {
    // move forward
    if (direction == '^')
    {
      position.y -= step;
    }
    else if (direction == '>')
    {
      position.x += step;
    }
    else if (direction == 'v')
    {
      position.y += step;
    }
    else if (direction == '<')
    {
      position.x -= step;
    }
  }

  void MoveNorth(int step)
  {
    position.y -= step;
  }

  void MoveSouth(int step)
  {
    position.y += step;
  }

  void MoveEast(int step)
  {
    position.x += step;
  }

  void MoveWest(int step)
  {
    position.x -= step;
  }

  char direction{ '>' };
  AOC::Point position{ 0, 0 };
};

int main()
{
  ifstream in("..\\..\\Day12\\src\\_Input.in");
  // ofstream out("..\\..\\Day12\\src\\_Output.out");

  FStreamReader reader(in);
  auto lines = reader.ReadLines();

  Ship ship;

  for (auto& line : lines)
  {
    char direction = line[0];
    int value = atoi(line.substr(1).c_str());

    switch (direction)
    {
    case 'N': ship.MoveNorth(value); break;
    case 'S': ship.MoveSouth(value); break;
    case 'E': ship.MoveEast(value); break;
    case 'W': ship.MoveWest(value); break;
    case 'F': ship.MoveForward(value); break;
    case 'L': 
      while (value > 0) {
        ship.TurnLeft();
        value -= 90;
      }
      break;
    case 'R': 
      while (value) {
        ship.TurnRight();
        value -= 90;
      }
      break;
    }
  };


  cout << AOC::ManhattenDistance(AOC::Point{0,0}, ship.GetPosition());

  return 0;
}
